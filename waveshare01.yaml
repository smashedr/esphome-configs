# Waveshare

substitutions:
  # https://esphome.io/components/substitutions
  friendly_name: "Desk Waveshare"
  box_num: "11"
  box_name: "espwave"
  type: "esp32"
  board: "esp32-s3-devkitc-1"
  comment: "Touch Screen"

packages:
  # https://esphome.io/components/packages.html
  common: !include { file: include/common.yaml }
  debug: !include { file: include/debug.yaml }

${type}:
  # https://esphome.io/#supported-microcontrollers
  variant: esp32s3
  flash_size: 8MB
  framework:
    sdkconfig_options:
      COMPILER_OPTIMIZATION_SIZE: "y"
      CONFIG_ESP32S3_DATA_CACHE_64KB: "y"
      # https://www.waveshare.com/wiki/ESP32-S3-Touch-LCD-4.3#Hardware_Connection
      CONFIG_FREERTOS_HZ: "1000"
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: "y"
      CONFIG_SPIRAM_MODE_OCT: "y"
      CONFIG_IDF_EXPERIMENTAL_FEATURES: "y"
      CONFIG_SPIRAM_SPEED_120M: "y"
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: "y"
      CONFIG_SPIRAM_RODATA: "y"
      CONFIG_ESP32S3_DATA_CACHE_LINE_64B: "y"
      CONFIG_COMPILER_OPTIMIZATION_PERF: "y"
      CONFIG_LV_MEM_CUSTOM: "y"
      CONFIG_LV_MEMCPY_MEMSET_STD: "y"
      CONFIG_LV_ATTRIBUTE_FAST_MEM: "y"

esphome:
  # https://esphome.io/components/esphome
  platformio_options:
    build_flags: "-DBOARD_HAS_PSRAM"
    board_build.arduino.memory_type: qio_opi
    board_build.flash_mode: dio
    board_upload.maximum_ram_size: 524288
  on_boot:
    - priority: 800
      # Hardware Initialized
      then:
        - logger.log: "Boot 800"

    - priority: 600
      # Sensors Initialized
      then:
        - logger.log: "Boot 600"

    - priority: 400
      then:
        - logger.log: "Boot 400"

    - priority: 300
      # NOT CONFIRMED: LVGL Setup complete
      then:
        - logger.log: "Boot 300"

    - priority: 250
      # WiFi Initialized
      then:
        - logger.log: "Boot 250"
        - lvgl.widget.hide: boot_screen
        - lvgl.widget.show: [top_overlay, bottom_overlay]

    - priority: 240
      # NOT CONFIRMED: WiFi Connected
      then:
        - logger.log: "Boot 240"

    - priority: 200
      # API Connected
      then:
        - logger.log: "Boot 200"

    - priority: -100
      # Everything Ready
      then:
        - logger.log: "Boot -100"

wifi:
  # https://esphome.io/components/wifi
  on_connect:
    - logger.log: "wifi: on_connect"
    - script.execute: update_wifi_stats
  on_disconnect:
    - logger.log: "wifi: on_disconnect"
    - script.execute: update_wifi_stats
    - lvgl.label.update:
        id: header_wifi
        text: "\U000F092B" # wifi-strength-alert-outline

api:
  # https://esphome.io/components/api
  reboot_timeout: 0s
  on_client_connected:
    - if:
        condition:
          lambda: 'return (0 == client_info.find("Home Assistant "));'
        then:
          - logger.log: "api: on_client_connected"
          - lvgl.label.update:
              id: header_api
              text: "\U000F07D0" # home-assistant
  on_client_disconnected:
    - if:
        condition:
          lambda: 'return (0 == client_info.find("Home Assistant "));'
        then:
          - logger.log: "api: on_client_disconnected"
          - lvgl.label.update:
              id: header_api
              text: "\U000F1A47" # home-off-outline

psram:
  # https://esphome.io/components/psram
  mode: octal
  speed: 80MHz

i2c:
  # https://esphome.io/components/i2c
  sda: GPIO08
  scl: GPIO09

#ch422g:
#  - id: ch422g_hub

#switch:
#  - platform: gpio
#    name: "Display Backlight ${box_num}"
#    id: backlight_switch
#    pin:
#      ch422g: ch422g_hub
#      number: 2
#      mode:
#        output: true
#      inverted: False
#    restore_mode: ALWAYS_ON
#    on_turn_on:
#      - lvgl.resume:
#      - lvgl.widget.redraw:
#    on_turn_off:
#      - lvgl.pause:

image:
  # https://esphome.io/components/image
  - file: images/esphome.png
    id: boot_logo
    type: RGB565
    use_transparency: true
  #- file: images/background.jpg
  #  id: background_img
  #  type: RGB565
  - file: images/livingroom.jpg
    id: living_room_img
    type: RGB565
  - file: images/kitchen.jpg
    id: kitchen_img
    type: RGB565
  - file: images/bedroom.jpg
    id: bedroom_img
    type: RGB565

touchscreen:
  # https://esphome.io/#touchscreen
  platform: gt911
  interrupt_pin: GPIO4
  #reset_pin:
  #  ch422g: ch422g_hub
  #  number: 1
  on_touch:
    then:
      - lambda: |-
          ESP_LOGD("touch", "x=%d y=%d", touch.x, touch.y);
      #- if:
      #    condition:
      #      - switch.is_off: backlight_switch
      #    then:
      #      - logger.log: "switch.turn_on: backlight_switch"
      #      - switch.turn_on: backlight_switch

display:
  # https://esphome.io/#display-components
  - platform: rpi_dpi_rgb
    auto_clear_enabled: false
    color_order: RGB
    update_interval: never # for LVGL
    dimensions:
      width: 800
      height: 480
    ##enable_pin:
    ##  ch422g: ch422g_hub
    ##  number: 2
    #reset_pin:
    #  ch422g: ch422g_hub
    #  number: 3
    de_pin:
      number: 5
    hsync_pin:
      number: 46
      ignore_strapping_warning: true
    vsync_pin:
      number: 3
      ignore_strapping_warning: true
    pclk_pin: 7
    pclk_frequency: 14MHz # 16MHz
    pclk_inverted: true # false
    hsync_back_porch: 8 # 30
    hsync_front_porch: 8 # 210
    hsync_pulse_width: 4 # 30
    vsync_back_porch: 16 # 4
    vsync_front_porch: 16 # 4
    vsync_pulse_width: 4
    data_pins:
      red: [1, 2, 42, 41, 40]
      blue: [14, 38, 18, 17, 10]
      green: [39, 0, 45, 48, 47, 21]

font:
  # https://esphome.io/components/font
  - file:
      type: gfonts
      family: "Red Hat Text"
    id: main_text26
    size: 26
    bpp: 4
    glyphsets: [GF_Latin_Core]
    extras:
      - file: "fonts/materialdesignicons-webfont.ttf"
        glyphs: &glyphs
          - "\U000F004D" # arrow-left
          - "\U000F0054" # arrow-right
          - "\U000F07C3" # dots-horizontal-circle
          - "\U000F0EBA" # home-analytics
          - "\U000F07D0" # home-assistant
          - "\U000F1A47" # home-off-outline
          - "\U000F0150" # clock-outline
          - "\U000F0E17" # calendar-month
          - "\U000F092B" # wifi-strength-alert-outline
          - "\U000F091F" # wifi-strength-1
          - "\U000F0922" # wifi-strength-2
          - "\U000F0925" # wifi-strength-3
          - "\U000F0928" # wifi-strength-4
          # Home Page
          - "\U000F110B" # reload-alert
          - "\U000F01F7" # emoticon-poop
          - "\U000F0717" # snowflake
          - "\U000F1C6F" # information-variant-circle
          - "\U000F040A" # play
          # Lights
          - "\U000F1802" # lightbulb-variant
          - "\U000F066F" # globe-light
          - "\U000F0A00" # lighthouse-on
          - "\U000F1A4C" # lightbulb-night
          # Devices
          - "\U000F0210" # fan
          - "\U000F0D91" # motion-sensor
          - "\U000F0CCB" # shield-home-outline
          - "\U000F05CB" # account-voice
          - "\U000F0D90" # monitor-off
          # Areas
          - "\U000F04B9" # sofa
          - "\U000F181C" # countertop
          - "\U000F08A0" # bed-empty
          - "\U000F1818" # bathtub
          # Weather
          - "\U000F050F" # thermometer
          - "\U000F058E" # water-percent
          - "\U000F059D" # weather-windy
          - "\U000F018B" # compass
          - "\U000F015F" # cloud
          # Weather Unused
          - "\U000F0505" # temperature-fahrenheit
          - "\U000F0504" # temperature-celsius
          - "\U000F0533" # trending-down
          - "\U000F0534" # trending-neutral
          - "\U000F0535" # trending-up
          # Unused
          - "\U000F092E" # wifi-strength-off-outline
          - "\U000F097E" # light-switch
          - "\U000F0156" # close
          - "\U000F05AD" # window-close
          - "\U000F1398" # close-thick
          - "\U000F06C9" # close-outline
  - file:
      type: gfonts
      family: "Red Hat Text"
    id: main_text32
    size: 32
    bpp: 4
    glyphsets: [GF_Latin_Core]
    extras:
      - file: "fonts/materialdesignicons-webfont.ttf"
        glyphs: *glyphs

  - file:
      type: gfonts
      family: "Red Hat Text"
    id: main_text48
    size: 48
    bpp: 4
    glyphsets: [GF_Latin_Core]
    extras:
      - file: "fonts/materialdesignicons-webfont.ttf"
        glyphs: *glyphs

  - file:
      type: gfonts
      family: "Red Hat Text"
    id: red_hat_mdi_48
    size: 48
    bpp: 4
    glyphsets: [GF_Latin_Core]
    extras:
      - file: "fonts/red_hat_text_mdi.ttf"
        glyphs: *glyphs

  - file:
      type: gfonts
      family: "Azeret Mono"
    id: mono_text48
    size: 48
    bpp: 4
    glyphsets: [GF_Latin_Core]

  - file:
      type: gfonts
      family: "Azeret Mono"
    id: mono_text72
    size: 72
    bpp: 4
    glyphsets: [GF_Latin_Core]

  - file: "fonts/materialdesignicons-webfont.ttf"
    id: icons_36
    size: 36
    bpp: 4
    glyphs: *glyphs
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: icons_48
    size: 48
    bpp: 4
    glyphs: *glyphs

lvgl:
  # https://esphome.io/components/lvgl/
  default_font: main_text26

  buffer_size: 25% # 100%

  on_idle:
    - timeout: 300s
      then:
        - logger.log: "LVGL is idle"
        - lvgl.page.show: home_page
        - lvgl.widget.hide: menu_overlay
        #- switch.turn_off: backlight_switch

  theme:
    # https://esphome.io/components/lvgl/#themes
    label:
      text_color: "White"
    button:
      bg_color: "MediumSlateBlue"
      checked:
        bg_color: "DarkOrchid"
    buttonmatrix:
      items:
        text_color: "White"
        text_font: icons_36
    obj:
      border_opa: TRANSP
      border_width: 0
      bg_opa: TRANSP
      pad_all: 0
      radius: 0

  style_definitions:
    - id: header_footer
      bg_opa: COVER
      border_opa: TRANSP
      radius: 0
      pad_all: 0
      pad_row: 0
      pad_column: 0
      text_color: "White"
      width: 100%

    - id: page_styles
      text_color: "White"
      bg_color: 0x1B1B1B
      bg_opa: COVER
      #bg_image_src: background_img
      #bg_image_opa: COVER

    - id: red_border
      #border_opa: COVER
      #border_color: "Red"
      #border_width: 1
      outline_width: 1
      outline_color: red

  msgboxes:
    - id: ralph_broke_it
      close_button: false
      title: "Who Broke It?"
      body:
        text: "- Ralph"
        bg_color: "Grey"
      buttons:
        - id: msgbox_close
          text: "Confirm Name"
          on_click:
            then:
              - logger.log: "msgbox_close: on_click"
              - lvgl.widget.hide: ralph_broke_it

  top_layer:
    widgets:
      - obj:
          id: menu_overlay
          hidden: true
          x: 0
          y: 0
          align: CENTER
          width: 100%
          height: 100%
          pad_top: 50 # TODO: Fix full screen menu
          pad_bottom: 70 # TODO: Fix full screen menu
          bg_color: "Black"
          bg_opa: 80%
          layout:
            type: FLEX
            flex_flow: COLUMN
            flex_align_main: SPACE_EVENLY
            flex_align_cross: SPACE_EVENLY
          on_press:
            then:
              - logger.log: "menu_overlay: on_press"
              - lvgl.widget.hide: menu_overlay
          widgets:
            # ROW 1 - Rooms
            - obj:
                width: 100%
                height: SIZE_CONTENT
                clickable: false
                layout:
                  type: FLEX
                  flex_flow: ROW
                  flex_align_main: SPACE_EVENLY
                  #flex_align_cross: START
                widgets:
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F04B9" # sofa
                      text: "Living"
                      page: living_room_page
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F181C" # countertop
                      text: "Kitchen"
                      page: kitchen_page
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F08A0" # bed-empty
                      text: "Bedroom"
                      page: bedroom_page
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F1818" # bathtub
                      text: "Bathroom"
                      page: test_page_1
            # ROW 2 - Other Pages
            - obj:
                width: 100%
                height: SIZE_CONTENT
                clickable: false
                layout:
                  type: FLEX
                  flex_flow: ROW
                  flex_align_main: SPACE_EVENLY
                  #flex_align_cross: START
                widgets:
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F040A" # play
                      text: "Start"
                      page: first_page
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F015F" # cloud
                      text: "Weather"
                      page: weather_page
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F0EBA" # home-analytics
                      text: "Home"
                      page: home_page
                  - !include
                    file: include/lvgl/button/menu_click.yaml
                    vars:
                      icon: "\U000F1C6F" # information-variant-circle
                      text: "Info"
                      page: stats_page

      - obj:
          id: top_overlay
          hidden: true
          align: TOP_MID
          styles: header_footer
          height: 36
          bg_color: 0x241F47 # top
          bg_grad_color: 0x7B68EE # bottom
          bg_grad_dir: VER
          bg_opa: COVER
          on_press:
            then:
              - logger.log: "top_overlay: on_press"
              - lvgl.page.show: stats_page
              - lvgl.widget.hide: menu_overlay # TODO: Fix full screen menu
          widgets:
            - label:
                align: TOP_LEFT
                text_align: LEFT
                text: "\U000F0150 --:--" # clock-outline
                id: header_time
            - label:
                align: CENTER
                text_align: CENTER
                text: "Connecting..."
                id: header_date
            - obj:
                align: TOP_RIGHT
                #text_align: RIGHT
                width: 33%
                clickable: false
                layout:
                  type: FLEX
                  flex_flow: ROW
                  flex_align_main: END
                  #flex_align_cross: SPACE_EVENLY
                widgets:
                  - label:
                      text: "--.- °F" # temperature-fahrenheit
                      id: header_temp
                  - label:
                      text: "\U000F1A47" # home-off-outline
                      id: header_api
                  - label:
                      text: "\U000F092B" # wifi-strength-alert-outline
                      id: header_wifi

      - buttonmatrix:
          id: bottom_overlay
          hidden: true
          align: BOTTOM_MID
          styles: header_footer
          height: 60
          bg_color: 0x7B68EE # top
          bg_grad_color: 0x241F47 # bottom
          bg_grad_dir: VER
          #bg_opa: COVER
          pad_all: 0
          outline_width: 0
          items:
            styles: header_footer
            bg_color: 0x7B68EE # top
            bg_grad_color: 0x241F47 # bottom
            bg_grad_dir: VER
          rows:
            - buttons:
                - id: page_prev
                  text: "\U000F004D" # arrow-left
                  on_press:
                    then:
                      - logger.log: "on_press Previous"
                      - lvgl.page.previous:
                          #animation: OUT_RIGHT
                          #time: 400ms
                      - lvgl.widget.hide: menu_overlay # TODO: Fix full screen menu
                - id: page_home
                  text: "\U000F0EBA" # home-assistant
                  on_press:
                    then:
                      - logger.log: "on_press Home"
                      - lvgl.page.show: home_page
                      - lvgl.widget.hide: menu_overlay # TODO: Fix full screen menu
                - id: page_menu
                  text: "\U000F07C3" # dots-horizontal-circle
                  on_press:
                    then:
                      - logger.log: "on_press Menu"
                      - lvgl.widget.show: menu_overlay
                - id: page_next
                  text: "\U000F0054" # arrow-right
                  on_press:
                    then:
                      - logger.log: "on_press Next"
                      - lvgl.page.next:
                          #animation: OUT_LEFT
                          #time: 400ms
                      - lvgl.widget.hide: menu_overlay # TODO: Fix full screen menu

  pages:
    # https://esphome.io/components/lvgl/#main-configuration
    - id: first_page
      styles: page_styles
      widgets:
        - obj:
            align: CENTER
            width: 100%
            height: SIZE_CONTENT
            layout:
              type: FLEX
              flex_flow: COLUMN
              flex_align_main: CENTER
              flex_align_cross: CENTER
            widgets:
              # ROW 1
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  pad_bottom: 20
                  layout:
                    type: FLEX
                    flex_flow: ROW_WRAP
                    flex_align_main: CENTER
                    flex_align_cross: CENTER
                  widgets:
                    - label:
                        align: CENTER
                        text: "This Is Your Life Now!"
                        text_font: main_text48
              # ROW 2
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW_WRAP
                    flex_align_main: CENTER
                    flex_align_cross: CENTER
                  widgets:
                    - button:
                        width: SIZE_CONTENT
                        height: 80
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F110B Reboot"
                        on_press:
                          then:
                            - logger.log: "on_press Reboot"
                            - button.press: btn_restart
                    - button:
                        width: SIZE_CONTENT
                        height: 80
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F0717 Antiburn"
                        on_click:
                          then:
                            - logger.log: "on_click Antiburn"
                            - if:
                                condition: lvgl.is_paused
                                then:
                                  - lvgl.resume:
                                  - lvgl.widget.redraw:
                            - lvgl.pause:
                                show_snow: true
                    - button:
                        width: SIZE_CONTENT
                        height: 80
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F0D90 Display"
                        on_click:
                          then:
                            - logger.log: "on_click Display"
                            #- switch.turn_off: backlight_switch
                            - lvgl.widget.show: ralph_broke_it
                            #- lvgl.page.show: living_room_page
              # ROW 3
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW_WRAP
                    flex_align_main: CENTER
                    flex_align_cross: CENTER
                  widgets:
                    - button:
                        width: SIZE_CONTENT
                        height: 80
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F1C6F Info" # information-variant-circle
                        on_press:
                          then:
                            - logger.log: "on_press Info"
                            - lvgl.page.show: stats_page
                    - button:
                        width: SIZE_CONTENT
                        height: 80
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F01F7 Do Shit" # emoticon-poop
                        on_press:
                          then:
                            - logger.log: "on_press Poop"
                            - lvgl.page.show: test_page_1
                    - button:
                        width: SIZE_CONTENT
                        height: 80
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F01F7 Do Shit" # emoticon-poop
                        on_press:
                          then:
                            - logger.log: "on_press Poop"
                            - lvgl.page.show: weather_page

        - obj:
            id: boot_screen
            x: 0
            y: 0
            width: 100%
            height: 100%
            bg_color: "Black"
            bg_opa: COVER
            widgets:
              - image:
                  align: CENTER
                  src: boot_logo
                  y: -40
              - spinner:
                  align: CENTER
                  y: 95
                  height: 80
                  width: 80
                  spin_time: 1s
                  arc_length: 60deg
                  arc_width: 8
                  indicator:
                    arc_color: "DeepSkyBlue"
                    arc_width: 8
            on_press:
              then:
                - lvgl.widget.hide: boot_screen
                - lvgl.widget.show: top_overlay
                - lvgl.widget.show: bottom_overlay

    - id: home_page
      styles: page_styles
      widgets:
        - obj:
            align: CENTER
            width: 100%
            height: 100%
            pad_top: 50
            pad_bottom: 70
            layout:
              type: FLEX
              flex_flow: COLUMN
              flex_align_main: SPACE_EVENLY
              flex_align_cross: SPACE_EVENLY
            widgets:
              # ROW 1 - Living Room
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    #flex_align_cross: CENTER
                  widgets:
                    - !include
                      file: include/lvgl/button/home_room.yaml
                      vars:
                        id: room_living_room
                        show: living_room_page
                        text: "\U000F04B9" # sofa
                    - !include
                      file: include/lvgl/button/home_temp.yaml
                      vars:
                        id: btn_living_room
                        entity_id: light.living_room
                        temp: living_room_temp
                        humi: living_room_humi
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_studio_light
                        entity_id: switch.studio_light
                        action: switch.toggle
                        text: "\U000F0A00" # lighthouse-on
                    - button:
                        width: 100
                        height: 100
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F0D91" # motion-sensor
                              text_font: icons_48
                    - button:
                        width: 100
                        height: 100
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F1A4C" # lightbulb-night
                              text_font: icons_48
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_enable_wake_51
                        entity_id: switch.esptest51_enable_wake_51
                        action: switch.toggle
                        text: "\U000F05CB" # account-voice

              # ROW 2 - Kitchen
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    #flex_align_cross: CENTER
                  widgets:
                    - !include
                      file: include/lvgl/button/home_room.yaml
                      vars:
                        id: room_kitchen
                        show: kitchen_page
                        text: "\U000F181C" # countertop
                    - !include
                      file: include/lvgl/button/home_temp.yaml
                      vars:
                        id: btn_kitchen
                        entity_id: light.kitchen
                        temp: kitchen_temp
                        humi: kitchen_humi
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_alarm_arm
                        entity_id: input_boolean.alarm_arm
                        action: switch.toggle
                        text: "\U000F0CCB" # shield-home-outline
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_motion_light_kitchen
                        entity_id: input_boolean.motion_light_kitchen
                        action: switch.toggle
                        text: "\U000F0D91" # motion-sensor
                    - button:
                        width: 100
                        height: 100
                        widgets:
                          - label:
                              align: CENTER
                              text: "\U000F1A4C" # lightbulb-night
                              text_font: icons_48
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_enable_wake_52
                        entity_id: switch.esptest52_enable_wake_52
                        action: switch.toggle
                        text: "\U000F05CB" # account-voice

              # ROW 3 - Bedroom
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    #flex_align_cross: CENTER
                  widgets:
                    - !include
                      file: include/lvgl/button/home_room.yaml
                      vars:
                        id: room_bedroom
                        show: bedroom_page
                        text: "\U000F08A0" # bed-empty
                    - !include
                      file: include/lvgl/button/home_temp.yaml
                      vars:
                        id: btn_bedroom_light
                        entity_id: light.bedroom_light
                        temp: bedroom_temp
                        humi: bedroom_humi
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_bedroom_fan
                        entity_id: switch.bedroom_fan
                        action: switch.toggle
                        text: "\U000F0210" # fan
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_motion_light_bedroom
                        entity_id: input_boolean.motion_light_bedroom
                        action: switch.toggle
                        text: "\U000F0D91" # motion-sensor
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_night_light_48
                        entity_id: switch.esptest48_night_light_48
                        action: switch.toggle
                        text: "\U000F1A4C" # lightbulb-night
                    - !include
                      file: include/lvgl/button/home_click.yaml
                      vars:
                        id: btn_enable_wake_48
                        entity_id: switch.esptest48_enable_wake_48
                        action: switch.toggle
                        text: "\U000F05CB" # account-voice

    - id: living_room_page
      styles: page_styles
      widgets:
        - obj:
            width: 100%
            height: 100%
            pad_top: 48
            pad_bottom: 68
            layout:
              type: FLEX
              flex_flow: COLUMN_WRAP
              flex_align_main: SPACE_EVENLY
              flex_align_cross: SPACE_EVENLY
            widgets:
              - obj:
                  align: CENTER
                  width: 100%
                  height: 46%
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                  widgets:
                    - image:
                        align: CENTER
                        width: 48%
                        height: 100%
                        radius: 10
                        src: living_room_img
                        clip_corner: true
                        widgets:
                          - label:
                              text: "Top Left"
                              text_color: "Black"
                    - obj:
                        width: 48%
                        height: 100%
                        #bg_opa: COVER
                        #bg_color: "LightGray"
                        bg_image_src: living_room_img
                        bg_image_opa: COVER
                        radius: 10
                        widgets:
                          - label:
                              text: "Top Right"
                              text_color: "Black"

              - obj:
                  align: CENTER
                  width: 100%
                  height: 46%
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                  widgets:
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: COVER
                        bg_color: "LightGray"
                        radius: 10
                        widgets:
                          - label:
                              text: "Bottom Left"
                              text_color: "Black"
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: COVER
                        bg_color: "LightGray"
                        radius: 10
                        widgets:
                          - label:
                              text: "Bottom Right"
                              text_color: "Black"

    - id: kitchen_page
      styles: page_styles
      widgets:
        - obj:
            width: 100%
            height: 100%
            pad_top: 48
            pad_bottom: 68
            layout:
              type: FLEX
              flex_flow: COLUMN_WRAP
              flex_align_main: SPACE_EVENLY
              flex_align_cross: SPACE_EVENLY
            widgets:
              - obj:
                  align: CENTER
                  width: 100%
                  height: 46%
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                  widgets:
                    - image:
                        align: CENTER
                        width: 48%
                        height: 100%
                        radius: 10
                        src: kitchen_img
                        clip_corner: true
                        widgets:
                          - label:
                              text: "Top Left"
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: TRANSP
                        #bg_color: "SlateGray"
                        bg_image_src: kitchen_img
                        bg_image_opa: COVER
                        radius: 10
                        widgets:
                          - label:
                              text: "Top Right"

              - obj:
                  align: CENTER
                  width: 100%
                  height: 46%
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                  widgets:
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: COVER
                        bg_color: "SlateGray"
                        radius: 10
                        widgets:
                          - label:
                              text: "Bottom Left"
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: COVER
                        bg_color: "SlateGray"
                        radius: 10
                        widgets:
                          - label:
                              text: "Bottom Right"

    - id: bedroom_page
      styles: page_styles
      widgets:
        - obj:
            width: 100%
            height: 100%
            pad_top: 48
            pad_bottom: 68
            layout:
              type: FLEX
              flex_flow: COLUMN_WRAP
              flex_align_main: SPACE_EVENLY
              flex_align_cross: SPACE_EVENLY
            widgets:
              - obj:
                  align: CENTER
                  width: 100%
                  height: 46%
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                  widgets:
                    - image:
                        align: CENTER
                        width: 48%
                        height: 100%
                        radius: 10
                        src: bedroom_img
                        clip_corner: true
                        widgets:
                          - label:
                              text: "Top Left"
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: COVER
                        #bg_color: "SlateGray"
                        bg_image_src: bedroom_img
                        bg_image_opa: COVER
                        radius: 10
                        widgets:
                          - label:
                              text: "Top Right"

              - obj:
                  align: CENTER
                  width: 100%
                  height: 46%
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                  widgets:
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: COVER
                        bg_color: "SlateGray"
                        radius: 10
                        widgets:
                          - label:
                              text: "Bottom Left"
                    - obj:
                        width: 48%
                        height: 100%
                        bg_opa: COVER
                        bg_color: "SlateGray"
                        radius: 10
                        widgets:
                          - label:
                              text: "Bottom Right"

    - id: test_page_1
      styles: page_styles
      #bg_opa: COVER
      #bg_color: "LightGray"
      #bg_image_src: background_img
      #bg_image_opa: COVER
      widgets:
        - obj:
            styles: red_border
            align: CENTER
            width: 100%
            height: 100%
            pad_top: 36 # TODO: Fix full screen sleep page
            layout:
              type: FLEX
              flex_flow: COLUMN
              #flex_align_main: START
              #flex_align_cross: START
              pad_column: 0
              pad_row: 0
            widgets:
              # TOP ROW
              - obj:
                  styles: red_border
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                    flex_align_track: CENTER
                    pad_column: 0
                    pad_row: 0
                  widgets:
                    - obj:
                        styles: red_border
                        #align: CENTER
                        width: 25%
                        height: SIZE_CONTENT
                        widgets:
                          - label:
                              text: "Top Left"
                              text_align: CENTER
                    - obj:
                        styles: red_border
                        #align: CENTER
                        height: SIZE_CONTENT
                        flex_grow: 1
                        widgets:
                          - label:
                              text: "Middle"
                              text_font: mono_text48
                              text_align: CENTER
                    - obj:
                        styles: red_border
                        #align: CENTER
                        width: 25%
                        height: SIZE_CONTENT
                        widgets:
                          - label:
                              text: "Top Right"
                              text_align: CENTER
              # ROW 1
              - obj:
                  styles: red_border
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    #flex_align_main: SPACE_EVENLY
                    #flex_align_cross: SPACE_EVENLY
                    #flex_align_track: CENTER
                  widgets:
                    - label:
                        text: "Bottom Row 1"
                        text_align: CENTER
              # ROW 2
              - obj:
                  styles: red_border
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: CENTER
                    #flex_align_cross: CENTER
                    #flex_align_track: CENTER
                  widgets:
                    - label:
                        text: "Bottom Row 2"
                        text_align: CENTER
              # ROW 3
              - obj:
                  styles: red_border
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: END
                    #flex_align_cross: CENTER
                    #flex_align_track: CENTER
                  widgets:
                    - label:
                        text: "Bottom Row 3"
                        text_align: CENTER

    - id: test_page_2
      styles: page_styles
      #bg_opa: COVER
      #bg_color: "LightGray"
      #bg_image_src: background_img
      #bg_image_opa: COVER
      widgets:
        - obj:
            styles: red_border
            align: CENTER
            width: 100%
            height: 100%
            pad_top: 36 # TODO: Fix full screen sleep page
            layout:
              type: FLEX
              flex_flow: COLUMN
              flex_align_main: CENTER
              flex_align_cross: CENTER
              pad_column: 0
              pad_row: 0
            widgets:
              # ROW 1
              - obj:
                  styles: red_border
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: CENTER
                    #flex_align_cross: SPACE_EVENLY
                    #flex_align_track: CENTER
                  widgets:
                    - label:
                        text: "Top Row 1"
                        text_align: CENTER
              # ROW 2
              - obj:
                  styles: red_border
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                    flex_align_track: CENTER
                    pad_column: 0
                    pad_row: 0
                  widgets:
                    - obj:
                        styles: red_border
                        align: CENTER
                        width: 25%
                        height: SIZE_CONTENT
                        widgets:
                          - label:
                              text: "Left"
                              text_font: mono_text48
                              #text_align: CENTER
                    - obj:
                        styles: red_border
                        align: CENTER
                        height: SIZE_CONTENT
                        flex_grow: 1
                        widgets:
                          - label:
                              text: "Middle"
                              text_font: mono_text72
                              #text_align: CENTER
                    - obj:
                        styles: red_border
                        align: CENTER
                        width: 25%
                        height: SIZE_CONTENT
                        widgets:
                          - label:
                              text: "Right"
                              text_font: mono_text48
                              #text_align: CENTER
              # ROW 3
              - obj:
                  styles: red_border
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: CENTER
                    #flex_align_cross: CENTER
                    #flex_align_track: CENTER
                  widgets:
                    - label:
                        text: "Bottom Row 3"
                        text_align: CENTER

    - id: weather_page
      styles: page_styles
      widgets:
        - obj:
            styles: red_border
            align: CENTER
            width: 100%
            height: 100%
            pad_top: 36 # TODO: Remove once full screen is fixed
            layout:
              type: FLEX
              flex_flow: ROW
              flex_align_main: SPACE_EVENLY
              #flex_align_cross: START
            text_font: red_hat_mdi_48
            widgets:
              # COLUMN 1
              - obj:
                  styles: red_border
                  align: CENTER
                  width: SIZE_CONTENT
                  height: 100%
                  layout:
                    type: FLEX
                    flex_flow: COLUMN
                    #flex_align_main: START
                    #flex_align_cross: START
                    pad_column: 0
                    pad_row: 0
                  widgets:
                    - label:
                        styles: red_border
                        #align: CENTER
                        width: SIZE_CONTENT
                        height: SIZE_CONTENT
                        text: "NOAA"
                        #id: weather_name
                    - obj:
                        styles: red_border
                        #align: CENTER
                        width: SIZE_CONTENT
                        height: SIZE_CONTENT
                        layout:
                          type: grid
                          grid_columns: [CONTENT, CONTENT]
                          grid_rows: [CONTENT, CONTENT, CONTENT, CONTENT]
                          pad_row: 10
                          pad_column: 20
                        widgets:
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 0
                              grid_cell_column_pos: 0
                              text: "\U000F050F"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 0
                              grid_cell_column_pos: 1
                              text: "--.- °F"
                              id: weather_temperature
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 1
                              grid_cell_column_pos: 0
                              text: "\U000F058E"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 1
                              grid_cell_column_pos: 1
                              text: "-- %"
                              id: weather_humidity
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 2
                              grid_cell_column_pos: 0
                              text: "\U000F059D"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 2
                              grid_cell_column_pos: 1
                              text: "-- mph"
                              id: weather_wind_mph
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 3
                              grid_cell_column_pos: 0
                              text: "\U000F018B"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 3
                              grid_cell_column_pos: 1
                              text: "-- °"
                              id: weather_wind_deg
              # COLUMN 2
              - obj:
                  styles: red_border
                  align: CENTER
                  width: SIZE_CONTENT
                  height: 100%
                  layout:
                    type: FLEX
                    flex_flow: COLUMN
                    #flex_align_main: START
                    #flex_align_cross: START
                    pad_column: 0
                    pad_row: 0
                  widgets:
                    - label:
                        styles: red_border
                        #align: CENTER
                        width: SIZE_CONTENT
                        height: SIZE_CONTENT
                        text: "Outside"
                        #id: weather_name
                    - obj:
                        outline_width: 1
                        styles: red_border
                        #align: CENTER
                        width: SIZE_CONTENT
                        height: SIZE_CONTENT
                        layout:
                          type: grid
                          grid_columns: [CONTENT, CONTENT]
                          grid_rows: [CONTENT, CONTENT]
                          pad_row: 10
                          pad_column: 20
                        widgets:
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 0
                              grid_cell_column_pos: 0
                              text: "\U000F050F"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 0
                              grid_cell_column_pos: 1
                              text: "--.- °F"
                              id: outside_temperature
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 1
                              grid_cell_column_pos: 0
                              text: "\U000F058E"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 1
                              grid_cell_column_pos: 1
                              text: "-- %"
                              id: outside_humidity
              # COLUMN 3
              - obj:
                  styles: red_border
                  align: CENTER
                  width: SIZE_CONTENT
                  height: 100%
                  layout:
                    type: FLEX
                    flex_flow: COLUMN
                    #flex_align_main: START
                    #flex_align_cross: START
                    pad_column: 0
                    pad_row: 0
                  widgets:
                    - label:
                        styles: red_border
                        #align: CENTER
                        width: SIZE_CONTENT
                        height: SIZE_CONTENT
                        text: "Inside"
                        #id: weather_name
                    - obj:
                        outline_width: 1
                        styles: red_border
                        #align: CENTER
                        width: SIZE_CONTENT
                        height: SIZE_CONTENT
                        layout:
                          type: grid
                          grid_columns: [CONTENT, CONTENT]
                          grid_rows: [CONTENT, CONTENT]
                          pad_row: 10
                          pad_column: 20
                        widgets:
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 0
                              grid_cell_column_pos: 0
                              text: "\U000F050F"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 0
                              grid_cell_column_pos: 1
                              text: "--.- °F"
                              id: inside_temperature
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 1
                              grid_cell_column_pos: 0
                              text: "\U000F058E"
                          - label:
                              styles: red_border
                              grid_cell_row_pos: 1
                              grid_cell_column_pos: 1
                              text: "-- %"
                              id: inside_humidity

    - id: stats_page
      styles: page_styles
      widgets:
        - obj:
            align: TOP_MID
            width: 100%
            height: 100%
            pad_top: 40
            layout:
              type: FLEX
              flex_flow: COLUMN
              #flex_align_main: START
              #flex_align_cross: START
            widgets:
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: SPACE_EVENLY
                  widgets:
                    - obj:
                        align: CENTER
                        width: SIZE_CONTENT
                        height: SIZE_CONTENT
                        layout:
                          type: FLEX
                          flex_flow: COLUMN
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: SPACE_EVENLY
                        widgets:
                          - label:
                              text: "Uptime:"
                          - label:
                              text: "Reset:"
                          - label:
                              text: "WiFi:"
                          - label:
                              text: "Heap:"
                          - label:
                              text: "Version:"
                    - obj:
                        align: CENTER
                        width: 100%
                        height: SIZE_CONTENT
                        scrollbar_mode: "OFF"
                        flex_grow: 1
                        layout:
                          type: FLEX
                          flex_flow: COLUMN
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: SPACE_EVENLY
                        widgets:
                          - label:
                              text: "0 seconds"
                              id: stats_uptime
                          - label:
                              text: "-"
                              id: stats_reset
                          - label:
                              text: "Disconnected"
                              id: stats_wifi
                          - label:
                              text: "- KB free / - KB max block / - KB psram"
                              id: stats_heap
                          - label:
                              text: "-"
                              id: stats_version
              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  scrollbar_mode: "OFF"
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    #flex_align_main: SPACE_EVENLY
                    #flex_align_cross: SPACE_EVENLY
                  widgets:
                    - label:
                        text: "Device Info: Updating..."
                        id: stats_info
                        height: SIZE_CONTENT
                        long_mode: WRAP
                        width: 100%

script:
  # https://esphome.io/components/script
  - id: update_wifi_stats
    mode: restart
    then:
      - logger.log: "Execute Script: update_wifi_stats"
      - if:
          condition:
            wifi.connected:
          then:
            - logger.log: "WiFi is connected!"
            - component.update: wifi_info_signal
            - component.update: wifi_info_ssid
            - component.update: wifi_info_ip
            - lvgl.label.update:
                id: stats_wifi
                text:
                  format: "%s (%s) %s"
                  args:
                    - "id(wifi_info_ssid).state.c_str()"
                    - "id(wifi_info_ip).state.c_str()"
                    - "id(wifi_info_mac).state.c_str()"
          else:
            - logger.log: "WiFi is disconnected!"
            - lvgl.label.update:
                id: stats_wifi
                text: "Disconnected"

  - id: update_debug_stats
    mode: restart
    then:
      - logger.log: "Execute Script: update_debug_stats"
      - delay: 3s
      - logger.log:
          format: "%.0f B free / %.0f B max block / %.0f B psram"
          args:
            - "id(debug_heap_free).state"
            - "id(debug_heap_max).state"
            - "id(debug_psram).state"
      - lvgl.label.update:
          id: stats_heap
          text:
            format: "%.1f KB free / %.1f KB max block / %.1f KB psram"
            args:
              - "id(debug_heap_free).state / 1024"
              - "id(debug_heap_max).state / 1024"
              - "id(debug_psram).state / 1024"
      - lvgl.label.update:
          id: stats_info
          text:
            format: "Device Info: %s"
            args: ["id(debug_device_info).state.c_str()"]

  # TODO: Determine why this is not working as a script...
  - id: update_time
    mode: restart
    then:
      - logger.log: "Execute Script: update_time"
      - lvgl.label.update:
          id: header_time
          text: !lambda 'return id(ha_time).now().strftime("\U000F0150 %I:%M %p");' # clock-outline

time:
  # https://esphome.io/#time-components
  - platform: homeassistant
    id: ha_time
    timezone: "America/Los_Angeles"
    on_time_sync:
      then:
        - logger.log: "on_time_sync"
        #- script.execute: update_time
        #- script.execute: update_date
        - lvgl.label.update:
            id: header_time
            text: !lambda 'return id(ha_time).now().strftime("\U000F0150 %I:%M %p");' # clock-outline
        - lvgl.label.update:
            id: header_date
            text: !lambda 'return id(ha_time).now().strftime("\U000F0E17 %A %d %b");' # calendar-month

    on_time:
      - seconds: 0
        minutes: "*"
        then:
          - logger.log: "on_time: every minute"
          #- script.execute: update_time
          - lvgl.label.update:
              id: header_time
              text: !lambda 'return id(ha_time).now().strftime("\U000F0150 %I:%M %p");' # clock-outline

      - seconds: 0
        minutes: 0
        hours: 0
        then:
          - logger.log: "on_time: every day"
          #- script.execute: update_date
          - lvgl.label.update:
              id: header_date
              text: !lambda 'return id(ha_time).now().strftime("\U000F0E17 %A %d %b");' # calendar-month

binary_sensor:
  # https://esphome.io/#binary-sensor-components
  # Devices - Lights
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: living_room
      entity_id: light.living_room
      widget: btn_living_room
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: kitchen
      entity_id: light.kitchen
      widget: btn_kitchen
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: bedroom_light
      entity_id: light.bedroom_light
      widget: btn_bedroom_light
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: studio_light
      entity_id: switch.studio_light
      widget: btn_studio_light
  # Devices - Other
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: bedroom_fan
      entity_id: switch.bedroom_fan
      widget: btn_bedroom_fan
  # HA - Switches
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: motion_light_kitchen
      entity_id: input_boolean.motion_light_kitchen
      widget: btn_motion_light_kitchen
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: motion_light_bedroom
      entity_id: input_boolean.motion_light_bedroom
      widget: btn_motion_light_bedroom
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: alarm_arm
      entity_id: input_boolean.alarm_arm
      widget: btn_alarm_arm
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: night_light_48
      entity_id: switch.esptest48_night_light_48
      widget: btn_night_light_48
  # Boxes - Micro Wake Word
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: enable_wake_48
      entity_id: switch.esptest48_enable_wake_48
      widget: btn_enable_wake_48
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: enable_wake_51
      entity_id: switch.esptest51_enable_wake_51
      widget: btn_enable_wake_51
  - !include
    file: include/lvgl/binary/ha_widget.yaml
    vars:
      id: enable_wake_52
      entity_id: switch.esptest52_enable_wake_52
      widget: btn_enable_wake_52
  # Boxes - Presence
  - !include
    file: include/lvgl/binary/ha_press_bg.yaml
    vars:
      id: presence_47
      entity_id: binary_sensor.presence_47
      widget: room_kitchen
      press_color: "MediumOrchid"
      release_color: "LightGray"
  - !include
    file: include/lvgl/binary/ha_press_bg.yaml
    vars:
      id: presence_48
      entity_id: binary_sensor.esptest48_presence_48
      widget: room_bedroom
      press_color: "MediumOrchid"
      release_color: "LightGray"

text_sensor:
  # https://esphome.io/#text-sensor-components
  # https://esphome.io/components/text_sensor/version
  - id: !extend esphome_version
    disabled_by_default: true
    on_value:
      then:
        lvgl.label.update:
          id: stats_version
          text:
            format: "ESPHome Version: %s"
            args: ["x.c_str()"]

  # https://esphome.io/components/debug
  - platform: debug
    reset_reason:
      name: "Reset Reason ${box_num}"
      on_value:
        then:
          lvgl.label.update:
            id: stats_reset
            text:
              format: "%s"
              args: ["x.c_str()"]

sensor:
  # https://esphome.io/#sensor-components
  - id: !extend wifi_info_signal
    on_value:
      then:
        #- logger.log:
        #    format: "wifi_info_signal: on_value: x: %.0f"
        #    args: ["x"]
        - if:
            condition:
              lambda: "return x <= -75;"
            then:
              lvgl.label.update:
                id: header_wifi
                text: "\U000F091F" # wifi-strength-1
                #text:
                #  format: "%.0f dBm \U000F091F" # wifi-strength-1
                #  args: ["x"]
        - if:
            condition:
              lambda: "return x <= -55 && x > -75;"
            then:
              lvgl.label.update:
                id: header_wifi
                text: "\U000F0922" # wifi-strength-2
                #text:
                #  format: "%.0f dBm \U000F0922" # wifi-strength-2
                #  args: ["x"]
        - if:
            condition:
              lambda: "return x <= -35 && x > -55;"
            then:
              lvgl.label.update:
                id: header_wifi
                text: "\U000F0925" # wifi-strength-3
                #text:
                #  format: "%.0f dBm \U000F0925" # wifi-strength-3
                #  args: ["x"]
        - if:
            condition:
              lambda: "return x > -35;"
            then:
              lvgl.label.update:
                id: header_wifi
                text: "\U000F0928" # wifi-strength-4
                #text:
                #  format: "%.0f dBm \U000F0928" # wifi-strength-4
                #  args: ["x"]

  ## TODO: Fix the lambda version for brevity compare to above...
  #- id: !extend wifi_info_signal
  #  on_value:
  #    then:
  #      - lambda: |-
  #          char buffer[64];
  #          if (x <= -75) {
  #            snprintf(buffer, sizeof(buffer), "%.0f dBm \U000F091F", x);
  #          } else if (x <= -55) {
  #            snprintf(buffer, sizeof(buffer), "%.0f dBm \U000F0922", x);
  #          } else if (x <= -35) {
  #            snprintf(buffer, sizeof(buffer), "%.0f dBm \U000F0925", x);
  #          } else {
  #            snprintf(buffer, sizeof(buffer), "%.0f dBm \U000F0928", x);
  #          }
  #          lvgl.label_set_text(id(header_wifi), buffer);

  - id: !extend api_uptime
    on_value:
      then:
        lvgl.label.update:
          id: stats_uptime
          text: !lambda |-
            int uptime_seconds = x;
            int days = uptime_seconds / (24 * 3600);
            int hours = (uptime_seconds % (24 * 3600)) / 3600;
            int minutes = (uptime_seconds % 3600) / 60;
            int seconds = uptime_seconds % 60;
            std::string text;
            if (days > 0) {
              text += std::to_string(days) + " days, ";
            }
            if (hours > 0 || days > 0) {
              text += std::to_string(hours) + " hours, ";
            }
            if (minutes > 0 || days > 0 || hours > 0) {
              text += std::to_string(minutes) + " minutes, ";
            }
            text += std::to_string(seconds) + " seconds";
            return text.c_str();

  - platform: debug
    psram:
      name: "PSRAM ${box_num}"
      id: debug_psram
      disabled_by_default: true
      on_value:
        then:
          - script.execute: update_debug_stats

  # Outside
  #- !include
  #  file: include/lvgl/sensor/ha_label.yaml
  #  vars:
  #    id: temp02_22
  #    entity_id: sensor.temp02_22
  #    label: [header_temp, outside_temperature]
  #    format: "%.1f °F"
  - platform: homeassistant
    id: temp02_22
    entity_id: sensor.temp02_22
    on_value:
      - lvgl.label.update:
          id: [header_temp, outside_temperature]
          text:
            format: "%.1f °F"
            args: ["x"]

  - !include
    file: include/lvgl/sensor/ha_label.yaml
    vars:
      id: humi02_22
      entity_id: sensor.humi02_22
      label: outside_humidity
      format: "%.0f %%"

  # Bedroom
  - !include
    file: include/lvgl/sensor/ha_label.yaml
    vars:
      id: temp01_22
      entity_id: sensor.temp01_22
      label: bedroom_temp
      format: "%.1f"
  - !include
    file: include/lvgl/sensor/ha_label.yaml
    vars:
      id: humi01_22
      entity_id: sensor.humi01_22
      label: bedroom_humi
      format: "%.0f %%"

  # Living Room
  - platform: homeassistant
    id: temp03_22
    entity_id: sensor.temp03_22
    on_value:
      - lvgl.label.update:
          id: living_room_temp
          text:
            format: "%.1f"
            args: ["x"]
      - lvgl.label.update:
          id: inside_temperature
          text:
            format: "%.1f °F"
            args: ["x"]
  - platform: homeassistant
    id: humi03_22
    entity_id: sensor.humi03_22
    on_value:
      - lvgl.label.update:
          id: [living_room_humi, inside_humidity]
          text:
            format: "%.0f %%"
            args: ["x"]

  # Kitchen
  - !include
    file: include/lvgl/sensor/ha_label.yaml
    vars:
      id: temp04_22
      entity_id: sensor.temp04_22
      label: kitchen_temp
      format: "%.1f"
  - !include
    file: include/lvgl/sensor/ha_label.yaml
    vars:
      id: humi04_22
      entity_id: sensor.humi04_22
      label: kitchen_humi
      format: "%.0f %%"

  # Weather
  #- !include
  #  file: include/lvgl/sensor/ha_label_attr.yaml
  #  vars:
  #    id: nws_friendly_name
  #    entity_id: weather.f6219
  #    label: weather_name
  #    format: "%s"
  #    attribute: friendly_name
  - !include
    file: include/lvgl/sensor/ha_label_attr.yaml
    vars:
      id: nws_temperature
      entity_id: weather.f6219
      label: weather_temperature
      format: "%.1f °F"
      attribute: temperature
  - !include
    file: include/lvgl/sensor/ha_label_attr.yaml
    vars:
      id: nws_humidity
      entity_id: weather.f6219
      label: weather_humidity
      format: "%.0f %%"
      attribute: humidity
  - !include
    file: include/lvgl/sensor/ha_label_attr.yaml
    vars:
      id: nws_wind_speed
      entity_id: weather.f6219
      label: weather_wind_mph
      format: "%.0f mph"
      attribute: wind_speed
  - !include
    file: include/lvgl/sensor/ha_label_attr.yaml
    vars:
      id: nws_wind_bearing
      entity_id: weather.f6219
      label: weather_wind_deg
      format: "%.0f °"
      attribute: wind_bearing
